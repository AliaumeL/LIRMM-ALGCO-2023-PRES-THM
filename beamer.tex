%! TeX program = xelatex
\documentclass{beamer}

\input{globals/packages}
\input{globals/colorscheme}
\input{globals/theme}

\input{globals/macros}
\input{globals/mathdefs}
\input{globals/knowledges.kl}

\input{globals/metadata}

\newcommand{\tightlist}{}

\begin{document}

\begin{frame}
    \maketitle
\end{frame}

\begin{frame}{Guessing Game}
    \begin{center}
        \foreach[count=\xi] \i in {1,...,5} {%
            \only<\xi>{%
                \includegraphics[width=15cm]{figures/quizz_Page \i.png}%
            }%
        }
    \end{center}
\end{frame}

\begin{frame}{Guessing Game for monotone sentences}
    \begin{lemma}
        \vspace{0.1em}
        For every non-trivial sentence $\varphi$,
        the following are equivalent:
        \begin{enumerate}
            \item $\varphi \equiv \exists^{\geq n} x. \top$ over $\Paths$;
            \item $\varphi$ is \textbf{monotone} over $\Paths$;
            \item The set of models of $\varphi$ (in $\Paths$)
                is described using a single element.
        \end{enumerate}
    \end{lemma}
    \pause
    \begin{alertblock}{New item found!}
        \vspace{0.1em}
        \centering
        This is the Łoś-Tarski Theorem (for $\Paths$).
    \end{alertblock}
\end{frame}

\section{Preservation Theorems}
\subsection{What, why, and where?}

\begin{frame}{Monotonicity}
    \begin{definition}[Induced Substructure]
        \vspace{0.1em}
        Existence of a \textbf{strong} \textbf{injective} \textbf{homomorphism}
        between structures $\model{A}$ and $\model{B}$:
        \begin{equation*}
            \model{A} \isubleq \model{B} 
        \end{equation*}
    \end{definition}
    \begin{center}
        \foreach[count=\xi] \i in {6,7,8} {%
            \only<\xi>{%
                \includegraphics[width=11cm]{figures/quizz_Page \i.png}%
            }%
        }
    \end{center}
\end{frame}

\begin{frame}{Induced substructures}
    \begin{block}{Comparing paths, cycles, cliques ...}
        \begin{itemize}
            \item For finite paths, $\aPath{n} \isubleq \aPath{m} \iff n \leq m$
            \item For finite cycles, $\aCycle{n} \isubleq \aCycle{m} \iff n = m$
            \item For finite cliques, $\aClique{n} \isubleq \aClique{m} \iff n \leq m$.
        \end{itemize}
    \end{block}
\end{frame}

\begin{frame}{Formulas}
    \begin{block}{The logic $\FO$ and its existential fragment $\EFO$}
        \begin{equation*}
        \varphi := \underbrace{\varphi \wedge \varphi
                \mid \varphi \vee \varphi
                \mid \neg R(\vec{x})
                \mid R(\vec{x})
                \mid \exists x. \varphi
                }_{\onslide<2->{\EFO}}
                \onslide<2->{\color{B2}
                 \mid \forall x. \varphi}
        \end{equation*}
    \end{block}
    \pause\pause
    \begin{equation*}
        \underbrace{
            \exists x. \neg B(x)
        }_{\onslide<4>{\in} \EFO}
        \quad \quad
        \underbrace{\forall x. B(x)
        }_{\onslide<4>{\not\in} \EFO}
    \end{equation*}
\end{frame}

\begin{frame}{Drawing conventions}
    \begin{center}
        \foreach[count=\xi] \i in {9,10,11} {%
            \only<\xi>{%
                \includegraphics[width=9cm]{figures/quizz_Page \i.png}%
            }%
        }
    \end{center}
\end{frame}

\begin{frame}{The Łoś-Tarski Theorem}
    \begin{theorem}[{\cite{TARSKI57,LOS55}}]
        \vspace{0.1em}
        For every first order
        sentence \(\varphi\), the following are equivalent:
        \begin{enumerate}
        \item
            \(\varphi\) is \emph{preserved under extensions}
            \hfill
            (\textbf{monotone} for $\isubleq$)
        \item
          \(\varphi\) is equivalent to an existential sentence
          \hfill
          ($\varphi \equiv \psi$ for some $\psi \in \EFO$)
        \item
          \(\varphi\) is the \(\subseteq_i\)-upwards closure of finitely many
          \emph{finite} models
          \hfill
          ($\modset{\varphi} = \upset{\model{A}_1, \dots, \model{A}_n}$)
        \end{enumerate}
    \end{theorem}
    \pause
    Note that the only difficult implication of the theorem is (1) implies
    (2/3).
    \pause
    \begin{alertblock}{!! Over the class of all structures !!}
    \end{alertblock}
\end{frame}

\subsection{In the finite?}\label{in-the-finite}

\begin{frame}{Łoś-Tarski in the finite?}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.7614}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.2386}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Class of Structures
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Relativisation
\end{minipage} \\
\midrule\noalign{}
\endhead
All finite structures & NO \autocite{TAIT59} \\
\(\emptyset\) & YES \\
Bounded tree-depth & YES \autocite{wqo:DING92} \\
Paths & YES \\
Cliques & YES \\
Cycles and Paths & NO \\
Bounded degree, hereditary, and closed under disjoint unions & YES
\autocite{ADG08} \\
Planar Graphs & NO \autocite{ADG08} \\
\bottomrule\noalign{}
\end{longtable}
\end{frame}

\subsection{Theoretical implications?}\label{theoretical-implications}

\begin{frame}{Theoretical implications?}

    Using the \textbf{Homomorphism Preservation Theorem}
    (variation of the Łoś--Tarski Theorem).

    \textbf{\autocite[Proposition 1]{LIBK11}.} Naïve evaluation of a query
    \(q\) computes its \emph{certain answers} if and only if \(q\) is a
    union of conjunctive query.

    \textbf{\autocite[Theorem 17]{DENJ08}.} The \emph{core chase} terminates
    on an initial database \(I\) and constraints \(\Sigma\) if and only if
    \(\mathop{\uparrow}(\Sigma \cap I)\) is first-order definable.

\end{frame}

\subsubsection{What are the tools?}

\begin{frame}{The usual proof scheme \hfill (in hereditary classes)}
    Given a sentence $\varphi \in \FO$ that is preserved under $\isubleq$ (over a class of interest).
    \begin{center}
        \includegraphics[width=8cm]{figures/quizz_Page 12.png}
    \end{center}
    \pause
    \begin{itemize}
        \item List minimal models of $\varphi$
        \item Assume that $\model{A} \models \varphi$ is extremely large
        \item Construct $\model{B} \isubleq \model{A}$ that continues
            to satisfy $\varphi$, but is smaller.
        \item Conclude.
    \end{itemize}
\end{frame}


\begin{frame}{The best ``generic'' result prior to this work}
    \begin{theorem}[\cite{ADG08}]
        \vspace{0.1em}
        Let $\mathcal{C}$ be a \textbf{hereditary} class of finite structures
        closed under \textbf{disjoint unions}.
        Then, item $1$ implies item $2$:
        \begin{enumerate}
            \item $\mathcal{C}$ has \emph{bounded degree},
            \item The Łoś-Tarski theorem relativises to $\mathcal{C}$.
        \end{enumerate}
    \end{theorem}
    \pause
    \begin{block}{Works for infinitely many classes}
    \end{block}
\end{frame}

\section{The results}\label{the-results}

\subsection{Localisations}\label{localisations}

\begin{frame}{Main theorem}

    \begin{theorem}[The localisation theorem]
        \vspace{0.1em}
        Let $\mathcal{C}$ be a \textbf{hereditary} class of finite structures
        closed under \textbf{disjoint unions}.
        Then, the following are equivalent:
        \begin{enumerate}
            \item The Łoś-Tarski theorem relativises to $\mathcal{C}$,
            \item The Łoś-Tarski theorem \textbf{locally} relativises to $\mathcal{C}$.
        \end{enumerate}
    \end{theorem}

    \pause

    \begin{block}{Remarks}
        \begin{itemize}
            \item Is now an equivalence.
            \item Strictly generalises \cite{ADG08}.
        \end{itemize}
    \end{block}
\end{frame}

\subsection{Locality???}

\begin{frame}{What is a neighbourhood?}
    \begin{center}
        \centering
        \foreach[count=\xi] \i in {13,14,15} {%
            \only<\xi>{%
                \includegraphics[width=12cm]{figures/quizz_Page \i.png}%
            }%
        }
    \end{center}
\end{frame}

\begin{frame}{What is a localisation?}
    \begin{equation*}
        \Loc{\mathcal{C}}{k}{r} \defined
        \setof{
            \Neighb{\model{A}}{\vec{a}}{r}
        }{
            \vec{a} \in \model{A}^k
        }
        \quad .
    \end{equation*}
    \pause
    \begin{alertblock}{Remark for finite classes}
        \begin{equation*}
            \mathcal{C} = \bigcup_{k,r} \Loc{\mathcal{C}}{k}{r} \quad .
        \end{equation*}
    \end{alertblock}
\end{frame}

\begin{frame}{Example of localisations}
    \begin{equation*}
        \Loc{\Cycles}{1}{3} = ? 
    \end{equation*}
    \pause
    \begin{center}
        \includegraphics[width=8cm]{figures/quizz_Page 16.png}
    \end{center}
\end{frame}

\begin{frame}{Example of localisations}
    \begin{alertblock}{Locally finite?}
        \centering
        $\mathcal{C}$ has bounded degree
        $\iff$
        $\Loc{\mathcal{C}}{k}{r}$ is finite for all $r,k \geq 0$.
    \end{alertblock}
\end{frame}

\begin{frame}{How do we use such a theorem?}
    \begin{center}
        \includegraphics[width=15cm]{figures/quizz_Page 17.png}
    \end{center}
\end{frame}

\section{The proofs}\label{the-proofs}

\subsection{Positive Locality and Neighbourhroods}

\begin{frame}[standout]
    Until now, we never really used $\FO$!
\end{frame}

\subsubsection{Local formulas}\label{local-formulas}

\begin{frame}{Local formulas}
    \begin{block}{$r$-local formulas $\varphi(x)$}
        \begin{equation*}
            \model{A} \models \varphi(a)
            \iff
            \Neighb{\model{A}}{a}{r} \models \varphi(a)
            \quad
        \end{equation*}
    \end{block}
    \pause
    \begin{alertblock}{What about sentences?}
        \vspace{0.1em}
        \begin{itemize}
            \item \textbf{Basic local sentences} \cite{GAIF82}
                ($\varphi(x)$ is $r$-local)
        \begin{equation*}
            \exists^{\geq n}_{r} x. \varphi(x) \quad .
        \end{equation*}
    \item \textbf{Existential-local sentences} ($\varphi(\vec{x})$ is $r$-local)
        \begin{equation*}
            \exists \vec{x}. \varphi(\vec{x}) \quad .
        \end{equation*}
        \end{itemize}
    \end{alertblock}
\end{frame}

\begin{frame}{Evaluating a basic local sentence}
    \begin{equation*}
            \exists^{\geq n}_{r} x. \varphi(x) \quad .
    \end{equation*}
    \begin{enumerate}
        \item For each node $a \in \model{A}$, decide whether
            $\Neighb{\model{A}}{a}{r} \models \varphi(a)$.
        \item Decide if there exists a set of at least $n$ points
            with non-intersecting $r$ neighbourhoods that 
            locally satisfy $\varphi$
            ($r$-independent set).
    \end{enumerate}
\end{frame}

\begin{frame}{Positive Locality}
    \begin{theorem}[\cite{GAIF82}]
        \vspace{0.1em}
        Every sentence \(\varphi\) is
        equivalent to a Boolean combination of basic local sentences.
    \end{theorem}

    \pause
    \vspace{1em}
    \hrule
    \vspace{0.8em}

    \begin{theorem}[Positive Locality]
        \vspace{0.1em}
        For every sentence \(\varphi\), the following are
        equivalent:

        \begin{enumerate}
        \tightlist
        \item
          \(\varphi\) is equivalent to a \textbf{positive} Boolean combination
          of basic local sentences.
        \item
          \(\varphi\) is equivalent to an existential local sentence.
        \end{enumerate}
    \end{theorem}
\end{frame}

\subsection{Combinatorics of
Neighbourhroods}\label{combinatorics-of-neighbourhroods}

\begin{frame}{Existential Local Łoś-Tarski}
    \begin{theorem}
        \vspace{0.1em}
        Let $\mathcal{C}$ be a \textbf{hereditary} class of finite structures
        closed under \textbf{disjoint unions}.
        Then, the following are equivalent:
        \begin{enumerate}
            \item 
                Łoś-Tarski \textbf{locally} relativises to
                $\mathcal{C}$,
            \item 
                Existential local sentences that are
                preserved under extensions over $\mathcal{C}$
                are equivalent to existential sentences.
        \end{enumerate}
    \end{theorem}
    \pause
    \begin{equation*}
        (k,r)-\text{Existential local over } \mathcal{C}
        \leftrightarrow
        \text{ Sentence over } \Loc{\mathcal{C}}{k}{r}
        \quad .
    \end{equation*}
\end{frame}

\begin{frame}{The main idea}
    \begin{alertblock}{To conclude it suffices to prove that ...}
        \vspace{0.1em}
        Sentences preserved under extensions
        are equivalent to existential local sentences.
    \end{alertblock}
    \pause
    \begin{block}{Replacing ``finite size" with ``bounded radius"}
        \vspace{0.1em}
        \begin{itemize}
            \item Consider a minimal model $\model{A}$ of a sentence $\varphi$
                and assume that it is very \emph{sparse}
            \item Extract a substructure $\model{B} \isubleq \model{A}$
                that satisfies $\varphi$.
            \item Conclude.
        \end{itemize}
    \end{block}
\end{frame}

\subsection{The core combinatorial argument}


\begin{frame}{First attempt}
    \begin{enumerate}
        \item 
            Consider a first order sentence \(\varphi := \bigvee_i \bigwedge_k
            \theta_{i,k}^+ \wedge \bigwedge_k \neg \theta_{i,k}^-\) preserved
            under extensions in Gaifman normal form, with locality radius $r$.

        \item
            Take $\model{A}$ a minimal model of $\varphi$.

        \item 
            Consider the \emph{positive} witnesses $\vec{a}$ of $\model{A}$.

        \item 
            Construct $\model{B} \defined \Neighb{\model{A}}{\vec{a}}{r}$.

        \item \textbf{Hope:} $\model{B} \models \varphi$.
    \end{enumerate}
\end{frame}

\begin{frame}{Problem}
    \begin{center}
        The neighbourhoods in 
        $\Neighb{\model{A}}{\vec{a}}{r}$
        are obtained as \emph{intersections}
        of neighbourhoods of $\model{A}$.
    \end{center}

    \begin{center}
        \includegraphics[width=10cm]{figures/quizz_Page 18.png}
    \end{center}
\end{frame}

\begin{frame}{Solution}
    \begin{alertblock}{Use monadic second order logic}
        \vspace{0.1em}
        Encode the intersections using monadic second order formulas:
        \(\exists X. \psi_{|X}\).
    \end{alertblock}

    \begin{alertblock}{Cluster the witnesses in one large neighbourhood}
    \end{alertblock}
\end{frame}

\begin{frame}{A graph theoretic result}
    \begin{lemma}[Frequent and rare colours]
        \vspace{0.1em}
        Let $N,r,k \in \Nat$. There exists bounds
        $K_m \geq k$ and $R_m \geq r$
        such that for all graphs $H$ with $N$ colours,
        there exist $r \leq R \leq R_m$,
        $k \leq K \leq K_m$, subsets $C^H$ and $G^H$
        of $H$ such that the following holds:
        \begin{enumerate}[<+->]
            \item Both $C^H$ and $G^H$ have size at most $K_m$;
            \item The sets $C^H$ and $G^H$ have non-intersecting $R$-neighbourhoods;
            \item Elements in $C^H$ have non-intersecting $R$-neighbourhoods;
            \item For every colour $c \in \set{1, \dots, N}$,
                one of the following holds:
                \begin{enumerate}
                    \item All nodes $x \in H$  with colour $c$
                        satisfy $\Neighb{H}{x}{r} \subseteq \Neighb{H}{C^H}{R}$;
                    \item There are at least $k$ distinct element in $G^H$
                        with colour $c$.
                \end{enumerate}
        \end{enumerate}
    \end{lemma}
\end{frame}

\begin{frame}
    \centering
    \includegraphics[width=10cm]{figures/quizz_Page 19.png}
\end{frame}

\begin{frame}{Actual Proof \hfill (simplified)}
    \begin{itemize}[<+->]
        \item Consider a sentence $\varphi$ in Gaifman normal form,
            with quantifier rank $q$, of locality radius $r$,
            and searching for independent sets of size $k$.
        \item Consider a minimal model $\model{A}$ of $\varphi$.
        \item Colour the nodes of $\model{A}$ with
            the collection of all $\MSO(q,k)$
            formulas satisfied on their $r$-local neighbourhood.
        \item Apply the combinatorial lemma.
        \item Extract the ``generic points'' and the ``core'' into a structure $\mathfrak{B}$.
        \item Conclude.
    \end{itemize}
\end{frame}

\section{Concluding remarks}
\subsection{And future works}

\begin{frame}{What was obtained}
    \begin{alertblock}{Positive results}
        \begin{itemize}
        \item
          A local-to-global characterisation of the relativisation of Łoś-Tarski.
        \item
          New classes of finite structures for which the Łoś-Tarski Theorem
          relativises.
        \item
          A characterisation of existential local sentences as those enjoying a
          positive Gaifman normal form.
        \item
          A technical lemma about the ``spatial'' repartition of local types in
          a given structure.
        \end{itemize}
    \end{alertblock}
\end{frame}

\begin{frame}{What's next?}
    \begin{exampleblock}{Open problems}
        \begin{itemize}
        \item
          Understand the Homomorphism Preservation Theorem, replacing \(\uplus\)
          with \(\oplus_X\)\ldots{}
        \item
            How can we generalise the theorem to ``dense'' classes?
        \item
          What about effectiveness?
        \item
          Towards decidability of these properties? (over classes of bounded
          linear clique width, classes of bounded clique width)
        \end{itemize}
    \end{exampleblock}
\end{frame}

\begin{frame}[allowframebreaks]{Bibliography}
    \printbibliography[heading=none]
\end{frame}

\appendix


\end{document}
